---
title: å‰ç«¯è·¨é¡µé¢é€šä¿¡
tag:
  - é¡¹ç›®æ€»ç»“
date: 2022-04-03
category:
  - å¼€å‘æ—¥å¿—
---

## èƒŒæ™¯

ç”¨æˆ·åœ¨å®é™…çš„æ“ä½œåœºæ™¯ä¸­ä¼šæ‰“å¼€å¤šä¸ª Tab é¡µé¢ Aã€Bã€Cã€Dã€E...ã€‚å½“ç”¨æˆ·åœ¨ E Tab é¡µé€€å‡ºç™»å½•ï¼Œå¹¶ä¸”ç™»å½•åˆ°æ–°çš„è´¦å·ï¼Œç„¶åç”¨æˆ·åˆ‡æ¢åˆ°é E çš„ Tab æ—¶ï¼Œå‘ç°ç™»å½•ä¿¡æ¯æ²¡æœ‰åˆ·æ–°ï¼Œ å¹¶ä¸”ç”±äºç™»å½•ä¿¡æ¯æ²¡æœ‰åˆ·æ–°ï¼Œä¼šå‡ºç°æ“ä½œå¼‚å¸¸ã€‚è¿™ä¸ªé—®é¢˜ç®€å•æ¥è¯´å°±æ˜¯å¤šä¸ª Tab ä¿¡æ¯æ²¡æœ‰åŒæ­¥ã€‚é—®é¢˜çš„å…³é”®åœ¨äºä¸€ä¸ª Tab é€€å‡ºé‡æ–°ç™»å½•ï¼Œéœ€è¦é€šçŸ¥åˆ°å…¶ä»–çš„ Tab åˆ·æ–°åˆ°æœ€æ–°çš„ä¿¡æ¯ã€‚æœ¬è´¨é—®é¢˜å°±æ˜¯**è§£å†³å‰ç«¯è·¨é¡µé¢é€šä¿¡**ã€‚

æœ¬ç¯‡æ–‡ç« å°±æ˜¯å¯¹å‰ç«¯è·¨é¡µé¢é€šä¿¡çš„è§£å†³æ–¹æ¡ˆåšäº†ä¸€ä¸ªäº†è§£ã€‚

## onstorage

WindowEventHandlers.onstorage å±æ€§åŒ…å«ä¸€ä¸ªåœ¨ storage äº‹ä»¶è§¦å‘æ—¶è¿è¡Œçš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚å½“æ›´æ”¹å­˜å‚¨æ—¶ä¼šè§¦å‘äº‹ä»¶å¤„ç†ç¨‹åºã€‚

### è¯­æ³•

```js
    window.onstorageÂ =Â functionï¼ˆï¼‰{...};
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
    window.onstorageÂ =Â function(e)Â {
    Â Â console.log(`TheÂ ${e.key}Â Â keyÂ hasÂ beenÂ changedÂ fromÂ ${e.oldValue}Â Â toÂ Â ${e.newValue}Â .`);
    };
```

```html
<div id="app"></div>
<button id="tab">æ–°å¼€Â Tab</button>
<button id="l-btn">è§¦å‘Â LocalStorageÂ æ›´æ–°</button>
<button id="s-btn">è§¦å‘Â SessionStorageÂ æ›´æ–°</button>
<script>
  window.onstorage = function (e) {
    console.log(
      `TheÂ ${e.key}Â Â keyÂ hasÂ beenÂ changedÂ fromÂ ${e.oldValue}Â Â toÂ Â ${e.newValue}Â .`
    )
  }

  document.getElementById('tab').onclick = function () {
    window.open('xxx')
  }

  document.getElementById('l-btn').onclick = function () {
    localStorage.setItem('storage1', Date.now())
  }

  document.getElementById('s-btn').onclick = function () {
    sessionStorage.setItem('storage1', Date.now())
  }
</script>
```

![onstorage.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8786a93f9d784e5a98e2224b52cb6452~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

![onstorage1.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/11cccdd395bb4ad887d116dd124f147f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

### Tips

1.  è¯¥äº‹ä»¶ä¸åœ¨å¯¼è‡´æ•°æ®å˜åŒ–çš„å½“å‰é¡µé¢è§¦å‘ï¼ˆå¦‚æœæµè§ˆå™¨åŒæ—¶æ‰“å¼€ä¸€ä¸ªåŸŸåä¸‹é¢çš„å¤šä¸ªé¡µé¢ï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ªé¡µé¢æ”¹å˜ æ•°æ®æ—¶ï¼Œå…¶ä»–æ‰€æœ‰é¡µé¢çš„ storage äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œè€ŒåŸå§‹é¡µé¢å¹¶ä¸è§¦å‘ storage äº‹ä»¶ï¼‰ã€‚
2.  sessionStorageï¼ˆâï¼‰ä¸èƒ½è§¦å‘ storage äº‹ä»¶ ï¼Œ localStorageï¼ˆâœ…ï¼‰å¯ä»¥ã€‚
3.  å¦‚æœä¿®æ”¹çš„å€¼æœªå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¸ä¼šè§¦å‘ onstorage äº‹ä»¶ã€‚
4.  ä¼˜ç‚¹ï¼šæµè§ˆå™¨æ”¯æŒæ•ˆæœå¥½ã€API ç›´è§‚ã€æ“ä½œç®€å•ã€‚ç¼ºç‚¹ï¼šéƒ¨åˆ†æµè§ˆå™¨éšèº«æ¨¡å¼ä¸‹ï¼Œæ— æ³•è®¾ç½® localStorageã€‚å¦‚ safariï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´ onstrage äº‹ä»¶æ— æ³•ä½¿ç”¨ã€‚

> é™¤å¼€å°‘æ•°æƒ…å†µï¼ŒlocalStorage çš„å…¼å®¹æ€§ä¸é”™ï¼Œå°±å½“å‰å›½å†…çš„æƒ…å†µï¼Œå·²ç»åŸºæœ¬æ²¡æœ‰é—®é¢˜äº†ã€‚localStorage çš„åŸç†å¾ˆç®€å•ï¼Œæµè§ˆå™¨ä¸ºæ¯ä¸ªåŸŸååˆ’å‡ºä¸€å—æœ¬åœ°å­˜å‚¨ç©ºé—´ï¼Œç”¨æˆ·ç½‘é¡µå¯ä»¥é€šè¿‡ localStorage å‘½åç©ºé—´è¿›è¡Œè¯»å†™ã€‚

![onstorageå…¼å®¹æ€§.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/117b0b6d4c2e45e3a70307edef85b8bb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

## BroadCast Channel

BroadcastChannel æ¥å£ä»£ç†äº†ä¸€ä¸ªå‘½åé¢‘é“ï¼Œ**å¯ä»¥è®©æŒ‡å®š origin ä¸‹çš„ä»»æ„ browsing context æ¥è®¢é˜…å®ƒã€‚å®ƒå…è®¸åŒæºçš„ä¸åŒæµè§ˆå™¨çª—å£ï¼ŒTab é¡µï¼Œframe æˆ–è€… iframe ä¸‹çš„ä¸åŒæ–‡æ¡£ä¹‹é—´ç›¸äº’é€šä¿¡**ã€‚é€šè¿‡è§¦å‘ä¸€ä¸ª message äº‹ä»¶ï¼Œæ¶ˆæ¯å¯ä»¥å¹¿æ’­åˆ°æ‰€æœ‰ç›‘å¬äº†è¯¥é¢‘é“çš„ BroadcastChannel å¯¹è±¡ã€‚

è¯´åˆ° BroadCast Channel ä¸å¾—ä¸è¯´ä¸€ä¸‹ postMessageï¼Œä»–ä»¬äºŒè€…çš„æœ€å¤§åŒºåˆ«å°±åœ¨äº postMessage æ›´åƒæ˜¯ç‚¹å¯¹ç‚¹çš„é€šä¿¡ï¼Œè€Œ BroadCast Channel æ˜¯å¹¿æ’­çš„æ–¹å¼ï¼Œç‚¹åˆ°é¢ã€‚

### è¯­æ³•

```js
//Â åˆ›å»º
const broadcastChannel = new BroadcastChannel('channelName')

//Â ç›‘å¬æ¶ˆæ¯
broadcastChannel.onmessage = function (e) {
  console.log('ç›‘å¬æ¶ˆæ¯:', e.data)
}

//Â å‘é€æ¶ˆæ¯
broadcastChannel.postMessage('æµ‹è¯•ï¼šä¼ é€æ¶ˆæ¯')

//Â å…³é—­
broadcastChannel.close()
```

```html
<div id="app"></div>
Â Â <button id="tab">æ–°å¼€Â Tab</button> Â Â <button id="l-btn">å‘é€æ¶ˆæ¯</button>
Â Â <button id="s-btn">å…³é—­</button> Â Â 
<script>
  //Â åˆ›å»º
  const broadcastChannel = new BroadcastChannel('channelName') //Â ç›‘å¬æ¶ˆæ¯

  broadcastChannel.onmessage = function (e) {
    console.log('ç›‘å¬æ¶ˆæ¯:', e.data)
  }

  document.getElementById('tab').onclick = function () {
    window.open('xxx')
  }

  document.getElementById('l-btn').onclick = function () {
    //Â å‘é€æ¶ˆæ¯
    broadcastChannel.postMessage('æµ‹è¯•ï¼Œä¼ é€æ¶ˆæ¯ï¼Œæˆ‘å‘é€æ¶ˆæ¯å•¦ã€‚ã€‚ã€‚')
  }

  document.getElementById('s-btn').onclick = function () {
    //Â å…³é—­
    broadcastChannel.close()
  }
</script>
```

![Broadcast Channel.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ceb90ba709a46cb88007f0940e2ec51~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?) ![Broadcast Channel1.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2d2fa27cb824f26bac50c8c87f88e44~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

### Tips

1.  ç›‘å¬æ¶ˆæ¯é™¤äº† .onmessage è¿™ç§æ–¹å¼ï¼Œè¿˜å¯ä»¥ ä½¿ç”¨ addEventListener æ¥æ·»åŠ 'message'ç›‘å¬ï¼Œ
2.  å…³é—­é™¤äº†ä½¿ç”¨ Broadcast Channel å®ä¾‹ä¸ºæˆ‘ä»¬æä¾›çš„ close æ–¹æ³•æ¥å…³é—­ Broadcast Channelã€‚æˆ‘ä»¬è¿˜å¯å–æ¶ˆæˆ–è€…ä¿®æ”¹ç›¸åº”çš„'message'äº‹ä»¶ç›‘å¬ã€‚ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ï¼šå–æ¶ˆ'message'ç›‘å¬åªæ˜¯è®©é¡µé¢ä¸å¯¹å¹¿æ’­æ¶ˆæ¯è¿›è¡Œå“åº”ï¼ŒBroadcast Channel ä»ç„¶å­˜åœ¨ï¼›è€Œè°ƒç”¨ close æ–¹æ³•ä¼šåˆ‡æ–­ä¸ Broadcast Channel çš„è¿æ¥ï¼Œæµè§ˆå™¨æ‰èƒ½å¤Ÿå°è¯•å›æ”¶è¯¥å¯¹è±¡ï¼Œå› ä¸ºæ­¤æ—¶æµè§ˆå™¨æ‰ä¼šçŸ¥é“ç”¨æˆ·å·²ç»ä¸éœ€è¦ä½¿ç”¨å¹¿æ’­é¢‘é“äº†ã€‚
3.  å…¼å®¹æ€§ï¼šå¦‚æœä¸ä½¿ç”¨ IE å’Œ sf on iOS æµè§ˆå™¨ï¼Œå…¼å®¹æ€§è¿˜æ˜¯å¯ä»¥çš„ã€‚

![BroadCast Channelå…¼å®¹æ€§.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a73bb72f39014c8a9cb5578495060c4a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

## Service Worker

Service Worker æ˜¯ä¸€ä¸ªå¯ä»¥é•¿æœŸè¿è¡Œåœ¨åå°çš„ Workerï¼Œèƒ½å¤Ÿå®ç°ä¸é¡µé¢çš„åŒå‘é€šä¿¡ã€‚å¤šé¡µé¢å…±äº«é—´çš„ Service Worker å¯ä»¥å…±äº«ï¼Œå°† Service Worker ä½œä¸ºæ¶ˆæ¯çš„å¤„ç†ä¸­å¿ƒï¼ˆä¸­å¤®ç«™ï¼‰å³å¯å®ç°å¹¿æ’­æ•ˆæœã€‚

### è¯­æ³•

```js
    <divÂ id="app"></div>
    <buttonÂ id="tab">æ–°å¼€Â Tab</button>
    <buttonÂ id="l-btn">å‘é€æ¶ˆæ¯</button>
    <script>
    Â Â /*Â åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒserviceWorkerÂ */
    Â Â ifÂ ('serviceWorker'Â inÂ navigator)Â {
    Â Â Â Â /*Â å½“é¡µé¢åŠ è½½å®Œæˆå°±åˆ›å»ºä¸€ä¸ªserviceWorkerÂ */
    Â Â Â Â window.addEventListener('load',Â functionÂ ()Â {
    Â Â Â Â Â Â /*Â åˆ›å»ºå¹¶æŒ‡å®šå¯¹åº”çš„æ‰§è¡Œå†…å®¹Â */
    Â Â Â Â Â Â /*Â scopeÂ å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šä½ æƒ³è®©Â serviceÂ workerÂ æ§åˆ¶çš„å†…å®¹çš„å­ç›®å½•ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†Â '/'ï¼Œè¡¨ç¤ºÂ æ ¹ç½‘åŸŸä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚*/
    Â Â Â Â Â Â navigator.serviceWorker.register('./serviceWorker.js',Â {Â scope:Â './'Â })
    Â Â Â Â Â Â Â Â .then(functionÂ (registration)Â {
    Â Â Â Â Â Â Â Â console.log('ServiceWorkerÂ registrationÂ successfulÂ withÂ scope:Â ',Â registration.scope);
    Â Â Â Â Â Â })
    Â Â Â Â Â Â Â Â .catch(functionÂ (err)Â {
    Â Â Â Â Â Â Â Â console.log('ServiceWorkerÂ registrationÂ failed:Â ',Â err);
    Â Â Â Â Â Â });
    Â Â Â Â });

    Â Â Â Â //Â ç›‘å¬æ¶ˆæ¯
    Â Â Â Â navigator.serviceWorker.addEventListener('message',Â functionÂ (e)Â {
    Â Â Â Â Â Â constÂ dataÂ =Â e.data;
    Â Â Â Â Â Â console.log('æˆ‘æ¥å—åˆ°æ¶ˆæ¯äº†ï¼š',Â data);
    Â Â Â Â });

    Â Â Â Â document.getElementById('l-btn').onclickÂ =Â functionÂ ()Â {
    Â Â Â Â Â Â navigator.serviceWorker.controllerÂ &&Â navigator.serviceWorker.controller.postMessage('æµ‹è¯•ï¼Œä¼ é€æ¶ˆæ¯ï¼Œæˆ‘å‘é€æ¶ˆæ¯å•¦ã€‚ã€‚ã€‚');
    Â Â Â Â };
    Â Â }
    </script>
```

```js
/*Â ç›‘å¬å®‰è£…äº‹ä»¶ï¼ŒinstallÂ äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥è®¾ç½®ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜é€»è¾‘Â */
this.addEventListener('install', function (event) {
  /*Â é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥é˜²æ­¢ç¼“å­˜æœªå®Œæˆï¼Œå°±å…³é—­serviceWorkerÂ */ event.waitUntil(
    /*Â åˆ›å»ºä¸€ä¸ªåå«V1çš„ç¼“å­˜ç‰ˆæœ¬Â */
    caches.open('v1').then(function (cache) {
      /*Â æŒ‡å®šè¦ç¼“å­˜çš„å†…å®¹ï¼Œåœ°å€ä¸ºç›¸å¯¹äºè·ŸåŸŸåçš„è®¿é—®è·¯å¾„Â */ return cache.addAll([
        './index.html'
      ])
    })
  )
})

/*Â æ³¨å†Œfetchäº‹ä»¶ï¼Œæ‹¦æˆªå…¨ç«™çš„è¯·æ±‚Â */
this.addEventListener('fetch', function (event) {
  event.respondWith(
    //Â magicÂ goesÂ here

    /*Â åœ¨ç¼“å­˜ä¸­åŒ¹é…å¯¹åº”è¯·æ±‚èµ„æºç›´æ¥è¿”å›Â */
    caches.match(event.request)
  )
})

/*Â ç›‘å¬æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶ä»–Â TabÂ é¡µé¢Â */
this.addEventListener('message', function (event) {
  this.clients.matchAll().then(function (clients) {
    clients.forEach(function (client) {
      //Â è¿™é‡Œçš„åˆ¤æ–­ç›®çš„æ˜¯è¿‡æ»¤æ‰å½“å‰Â TabÂ é¡µé¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Â visibilityStateÂ çš„çŠ¶æ€æ¥åˆ¤æ–­
      if (!client.focused) {
        client.postMessage(event.data)
      }
    })
  })
})
```

![Service Worker.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/130eccc4d4d942549d816209f3ae2fd5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

![Service Worker1.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a320b206fb24d8297c36bde3e021d8c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

### Tips

1.  Service workers æœ¬è´¨ä¸Šå……å½“ Web åº”ç”¨ç¨‹åºã€æµè§ˆå™¨ä¸ç½‘ç»œï¼ˆå¯ç”¨æ—¶ï¼‰ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ã€‚æ‰€ä»¥æœ¬è´¨ä¸Šæ¥è¯´ Service Worker å¹¶ä¸è‡ªåŠ¨å…·å¤‡â€œå¹¿æ’­é€šä¿¡â€çš„åŠŸèƒ½ï¼Œéœ€è¦æ”¹é€  Service Worker æ·»åŠ äº›ä»£ç ï¼Œå°†å…¶æ”¹é€ æˆæ¶ˆæ¯ä¸­è½¬ç«™ã€‚åœ¨ Service Worker ä¸­ç›‘å¬äº† message äº‹ä»¶ï¼Œè·å–é¡µé¢å‘é€çš„ä¿¡æ¯ã€‚ç„¶åé€šè¿‡ self.clients.matchAll() è·å–å½“å‰æ³¨å†Œäº† Service Worker çš„æ‰€æœ‰é¡µé¢ï¼Œé€šè¿‡è°ƒç”¨æ¯ä¸ªçš„ postMessage æ–¹æ³•ï¼Œå‘é¡µé¢å‘é€æ¶ˆæ¯ã€‚è¿™æ ·å°±æŠŠä»ä¸€å¤„ï¼ˆæŸä¸ª Tab é¡µé¢ï¼‰æ”¶åˆ°çš„æ¶ˆæ¯é€šçŸ¥ç»™äº†å…¶ä»–é¡µé¢ã€‚
2.  å…¼å®¹æ€§ï¼šIE å…¨å†›è¦†æ²¡ï¼Œå…¶ä»–æµè§ˆå™¨è¿˜è¡Œï¼Œæ•´ä½“æ¥è¯´ä¸€èˆ¬ã€‚

![Service Workerå…¼å®¹æ€§.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e6b17f5d2774ca0b6d04a502aaedf69~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

## open & opener

å½“æˆ‘ä»¬ ç³»ç»Ÿä¸­é€šè¿‡ window.open æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼Œwindow.open æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè¢«æ‰“å¼€é¡µé¢çš„å¼•ç”¨ï¼Œè€Œè¢«æ‰“å¼€é¡µé¢åˆ™å¯ä»¥é€šè¿‡ window.opener è·å–åˆ°æ‰“å¼€å®ƒçš„é¡µé¢çš„å¼•ç”¨ï¼ˆå½“ç„¶è¿™æ˜¯åœ¨æ²¡æœ‰æŒ‡å®š noopener çš„æƒ…å†µä¸‹ï¼‰ã€‚

### ç•ªå¤–å…³äº noopener

```html
<a href="https://google.com" target="_blank">Google</a>
```

æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­ç»å¸¸ä¼šè¿™æ ·ä½¿ç”¨ a æ ‡ç­¾è·³è½¬åˆ°ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œæœ‰æ—¶ï¼Œå½“æ‚¨å•å‡»ç½‘ç«™ä¸Šçš„é“¾æ¥æ—¶ï¼Œè¯¥é“¾æ¥å°†åœ¨æ–°é€‰é¡¹å¡ä¸­æ‰“å¼€ï¼Œä½†æ—§é€‰é¡¹å¡ä¹Ÿä¼šè¢«é‡å®šå‘åˆ°å…¶ä»–ç½‘ç»œé’“é±¼ç½‘ç«™ï¼Œå®ƒä¼šè¦æ±‚æ‚¨ç™»å½•æˆ–å¼€å§‹å°†ä¸€äº›æ¶æ„è½¯ä»¶ä¸‹è½½åˆ°æ‚¨çš„è®¾å¤‡ã€‚è¿™æ ·å­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œæ­¤æ—¶åœ¨æ–°æ‰“å¼€çš„é¡µé¢ä¸­å¯é€šè¿‡ window.opener è·å–åˆ°æºé¡µé¢çš„ window å¯¹è±¡ï¼Œ è¿™å°±åŸ‹ä¸‹äº†å®‰å…¨éšæ‚£ã€‚ æ¯”å¦‚ï¼š

- ä½ è‡ªå·±çš„ç½‘ç«™ Aï¼Œç‚¹å‡»å¦‚ä¸Šé“¾æ¥æ‰“å¼€äº†ç¬¬ä¸‰æ–¹ç½‘ç«™ Bã€‚
- æ­¤æ—¶ç½‘ç«™ B å¯ä»¥é€šè¿‡ window.opener è·å–åˆ° A ç½‘ç«™çš„ window å¯¹è±¡ã€‚
- ç„¶åé€šè¿‡ window.opener.location.href = '[www.baidu.com](https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com 'http://www.baidu.com')' è¿™ç§å½¢å¼è·³è½¬åˆ°ä¸€ä¸ªé’“é±¼ç½‘ç«™ï¼Œæ³„éœ²ç”¨æˆ·ä¿¡æ¯ã€‚

ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥æ·»åŠ å¼•å…¥äº† rel="noopener" å±æ€§ï¼Œ è¿™æ ·æ–°æ‰“å¼€çš„é¡µé¢ä¾¿è·å–ä¸åˆ°æ¥æºé¡µé¢çš„ window å¯¹è±¡äº†ï¼Œ æ­¤æ—¶ window.opener çš„å€¼æ˜¯ nullã€‚

```html
<a href="https://google.com" rel="noopener" target="_blank">Google</a>
```

ä½†æ˜¯ç”±äºä¸€äº›è€çš„æµè§ˆå™¨å¹¶ä¸æ”¯æŒ noopener ï¼Œé€šå¸¸ noopener å’Œ noreferrer ä¼šåŒæ—¶è®¾ç½®ï¼Œ rel="noopener noreferrer"ã€‚

### è¯­æ³•

å›åˆ°ä¸»é¢˜ï¼Œä½¿ç”¨ window.opener å¦‚ä½•å®ç°è·¨é¡µé¢é€šä¿¡äº†ã€‚

- æ”¶é›†å¯¹è±¡

```js
//Â  æ”¶é›† Â windowÂ  å¯¹è±¡ï¼šå•ä¸ªæ‰“å¼€é¡µé¢
const windowOpen = window.open('xxx')

//Â  æ”¶é›† Â windowÂ  å¯¹è±¡ï¼šå¤šä¸ªæ‰“å¼€é¡µé¢ï¼Œæ‰“å¼€ä¸€ä¸ªé¡µé¢å°±éœ€è¦å°†æ‰“å¼€çš„ Â windowÂ  å¯¹è±¡æ”¶é›†èµ·æ¥ï¼Œä»¥ä¾¿äºå‘å¸ƒå¹¿æ’­
const windowOpens = []
const windowOpen = window.open('xxx')
windowOpens.push(windowOpen)
```

- å‘é€æ¶ˆæ¯

```js
//Â  å‘é€æ¶ˆæ¯ï¼šå•ä¸ªé¡µé¢
windowOpen.postMessage(data)

//Â  å‘é€æ¶ˆæ¯ï¼šå¤šä¸ªé¡µé¢
windowOpens.forEach(window => window.postMessage(data))
// æ¥å—æ¶ˆæ¯ï¼Œå¯¹äºæ¥å—æ¶ˆæ¯æ¥è¯´ï¼Œå¯èƒ½åªæ˜¯æ¥å—æ¶ˆæ¯ï¼Œä½†æ˜¯å¯èƒ½æ¥å—æ¶ˆæ¯çš„é¡µé¢ä¹Ÿæ‰“å¼€äº†é¡µé¢ï¼Œè¿™ç§æƒ…å†µéœ€è¦å°†æ¶ˆæ¯ç»§ç»­ä¼ é€’ä¸‹å»
window.addEventListener('message', function (e) {
  const data = e.data
  console.log(data)
  windowOpens.forEach(window => window.postMessage(data))
})
```

### Tips

1.  åœ¨æ”¶é›†åˆ°çš„ window å¯¹è±¡ä¸­ï¼Œå¯èƒ½æœ‰çš„ Tab çª—å£è¢«å…³é—­äº†ï¼Œè¿™ç§æƒ…å†µä¸‹çš„ Tab ä¸éœ€è¦è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚
2.  å¯¹äºæ¥å—æ¶ˆæ¯çš„ä¸€æ–¹æ¥è¯´ï¼Œéœ€è¦ç»§ç»­ä¼ é€’æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ¶ˆæ¯å›ä¼ ï¼Œå¯èƒ½å‡ºç°ä¸¤è€…ä¹‹é—´æ¶ˆæ¯çš„æ­»å¾ªç¯ä¼ é€’ã€‚
3.  è¿™ç§æ–¹å¼ï¼Œç±»ä¼¼å‡»é¼“ä¼ èŠ±ï¼Œä¸€ä¸ªä¼ ä¸€ä¸ªï¼Œä¼ é€’çš„æ¶ˆæ¯ä»å‰å¾€åï¼Œä¸€æ¡é”é“¾ã€‚
4.  ä½†æ˜¯å¦‚æœé¡µé¢ä¸æ˜¯é€šè¿‡ä¸€ä¸ªé¡µé¢æ‰“å¼€çš„ï¼Œè€Œä¸”ç›´æ¥æ‰“å¼€çš„ï¼Œæˆ–è€…ä»ä¸‰æ–¹ç½‘ç«™è·³è½¬çš„ï¼Œé‚£è¿™æ¡é”é“¾å°†æ–­å¼€ã€‚**æ‰€ä»¥è¿™ç§æ–¹å¼åŸºæœ¬åªåšäº†è§£ï¼Œé—®é¢˜å¤ªå¤šï¼Œå¯ä¸åšå‚è€ƒã€‚**

å®Œå–„çš„ä»£ç å¦‚ä¸‹ï¼š

```html
<button id="tab">æ–°å¼€Â Tab</button>
<button id="l-btn">å‘é€æ¶ˆæ¯</button>
<script>
  //Â æ”¶é›†Â windowÂ å¯¹è±¡ï¼šå¤šä¸ªæ‰“å¼€é¡µé¢ï¼Œæ‰“å¼€ä¸€ä¸ªé¡µé¢å°±éœ€è¦å°†æ‰“å¼€çš„Â windowÂ å¯¹è±¡æ”¶é›†èµ·æ¥ï¼Œä»¥ä¾¿äºå‘å¸ƒå¹¿æ’­
  let windowOpens = []
  document.getElementById('tab').onclick = function () {
    //Â IPÂ åœ°å€ä¸ºæœ¬åœ°çš„æœåŠ¡
    const windowOpen = window.open(
      'http://127.0.0.1:5500/CrossPageCommunication/open&opener.html'
    )
    windowOpens.push(windowOpen)
  }

  document.getElementById('l-btn').onclick = function () {
    const data = {}
    console.log(windowOpens) //Â å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œå…ˆè¿›è¡Œå·²å…³é—­Â TabÂ çš„è¿‡æ»¤
    windowOpens = windowOpens.filter(window => !window.closed)

    if (windowOpens.length > 0) {
      //Â æ•°æ®æ‰“ä¸€ä¸ªæ ‡è®°
      data.tag = false
      data.message = 'æµ‹è¯•ï¼Œä¼ é€æ¶ˆæ¯ï¼Œæˆ‘å‘é€æ¶ˆæ¯å•¦ã€‚ã€‚ã€‚'
      windowOpens.forEach(window => window.postMessage(data))
    }
    if (window.opener && !window.opener.closed) {
      data.tag = true
      window.opener.postMessage(data)
    }
  }

  window.addEventListener('message', function (e) {
    const data = e.data
    console.log('æˆ‘æ¥å—åˆ°æ¶ˆæ¯äº†ï¼š', data.message) //Â é¿å…æ¶ˆæ¯å›ä¼ 
    if (window.opener && !window.opener.closed && data.tag) {
      window.opener.postMessage(data)
    } //Â è¿‡æ»¤æ‰å·²ç»å…³é—­çš„Â Tab
    windowOpens = windowOpens.filter(window => !window.closed) //Â é¿å…æ¶ˆæ¯å›ä¼ 
    if (windowOpens && !data.tag) {
      windowOpens.forEach(window => window.postMessage(data))
    }
  })
</script>
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5b9267898ac4b86a307f8745f16fb27~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

## SharedWorker

SharedWorker æ¥å£ä»£è¡¨ä¸€ç§ç‰¹å®šç±»å‹çš„ workerï¼Œå¯ä»¥ä»å‡ ä¸ªæµè§ˆä¸Šä¸‹æ–‡ä¸­è®¿é—®ï¼Œä¾‹å¦‚å‡ ä¸ªçª—å£ã€iframe æˆ–å…¶ä»– workerã€‚å®ƒä»¬å®ç°ä¸€ä¸ªä¸åŒäºæ™®é€š worker çš„æ¥å£ï¼Œå…·æœ‰ä¸åŒçš„å…¨å±€ä½œç”¨åŸŸ, SharedWorkerGlobalScopeã€‚

### è¯­æ³•

```js
    //Â åˆ›å»ºå…±äº«çº¿ç¨‹å¯¹è±¡
    letÂ workerÂ =Â newÂ SharedWorker("./sharedWorker.js");

    //Â æ‰‹åŠ¨å¯åŠ¨ç«¯å£
    worker.port.start();

    //Â å¤„ç†ä»Â workerÂ è¿”å›çš„æ¶ˆæ¯
    Â worker.port.onmessageÂ =Â functionÂ (val)Â {
    Â Â Â Â ...
    Â };
```

```html

    <buttonÂ id="tab">æ–°å¼€Â Tab</button>
    <buttonÂ id="l-btn">ç‚¹èµ</button>
    <p><span id="likedCount">è¿˜æ²¡æœ‰äººç‚¹èµ</span></span>ğŸ‘</p>
    <script>
    Â letÂ likedCountElÂ =Â document.querySelector("#likedCount");

    Â letÂ workerÂ =Â newÂ SharedWorker("./sharedWorker.js");

    Â console.log('worker.port',Â worker.port);

    Â worker.port.start();

    Â //Â ç›‘å¬æ¶ˆæ¯
    Â worker.port.onmessageÂ =Â functionÂ (val)Â {
    Â Â Â likedCountEl.innerHTMLÂ =Â val.data;
    Â };

    Â document.getElementById('tab').onclickÂ =Â functionÂ ()Â {
    Â Â Â //Â IPÂ åœ°å€ä¸ºæœ¬åœ°èµ·çš„æœåŠ¡
    Â Â Â constÂ windowOpenÂ =Â window.open('http://127.0.0.1:5500/CrossPageCommunication/sharedWorker/index.html');
    Â }

    Â document.getElementById('l-btn').onclickÂ =Â functionÂ ()Â {
    Â Â Â worker.port.postMessage('ç‚¹èµäº†');
    Â };
    </script>
```

```js
//Â ./sharedWorker.js
let a = 666

console.log('shared-worker')
onconnect = function (e) {
  const port = e.ports[0]
  console.log('shared-workerÂ connect') //Â ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼ç›‘å¬äº‹ä»¶ //Â port.addEventListener('message',Â ()Â =>Â { //Â Â Â port.postMessage(++a); //Â });

  port.postMessage(a)

  port.onmessage = () => {
    port.postMessage(++a)
  }
  console.log('å½“å‰ç‚¹èµæ¬¡æ•°:', a)
}
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd7a5c0c24cb4e6fb52dfc44e58d0efd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

### Tips

1.  å¦‚æœè¦ä½¿ SharedWorker è¿æ¥åˆ°å¤šä¸ªä¸åŒçš„é¡µé¢ï¼Œè¿™äº›é¡µé¢å¿…é¡»æ˜¯åŒæºçš„ï¼ˆç›¸åŒçš„åè®®ã€host ä»¥åŠç«¯å£ï¼‰ã€‚
2.  Shared Worker åœ¨å®ç°è·¨é¡µé¢é€šä¿¡æ—¶çš„ï¼Œå®ƒæ— æ³•ä¸»åŠ¨é€šçŸ¥æ‰€æœ‰é¡µé¢ï¼Œéœ€è¦åˆ·æ–°é¡µé¢æˆ–è€…æ˜¯å®šæ—¶ä»»åŠ¡æ¥æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯ã€‚åœ¨ä¾‹å­ä¸­æˆ‘æ˜¯æ‰‹åŠ¨åˆ·æ–°çš„ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨ setInterval æ¥å®šæ—¶åˆ·æ–°ã€‚
3.  å¦‚æœéœ€è¦è°ƒè¯• SharedWorkerï¼Œä½¿ç”¨ chrome://inspect/#workers

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a11db908656048ec90eb318de71352ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fe45213000f4bb8a18a6a10a9346072~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

1.  sharedWorker.js ä¸èƒ½ä½¿ç”¨ .addEventListener æ¥ç›‘å¬ message äº‹ä»¶ï¼Œç›‘å¬æ— æ•ˆã€‚ å…¼å®¹æ€§ä¸€èˆ¬ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5421c63125c24835921c47d54048caef~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

## æ€»ç»“

åœ¨ä¸Šé¢åˆ—ä¸¾äº†äº”ç§å‰ç«¯è·¨é¡µé¢é€šä¿¡çš„æ–¹å¼ï¼Œå½“ç„¶å¯¹å‰ç«¯æ¥è¯´è¿œè¿œä¸æ­¢è¿™äº”ç§æ–¹å¼ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ¡ˆä¾‹å¦‚ï¼šä½¿ç”¨ hashchangeã€cookieã€Websocketã€postMessage éƒ½æ˜¯å¯ä»¥çš„ã€‚æ–‡ç« ä¸­åªæ˜¯åˆ—ä¸¾äº†éƒ¨åˆ†ã€‚å¹¶ä¸”æ–‡ç« ä¸­çš„æ–¹æ¡ˆéƒ½æ˜¯é’ˆå¯¹åŒæºçš„ Tabã€‚

æ–‡ç« çš„å‰ä¸‰ç§è§£å†³æ–¹å¼ä¸è®ºæ˜¯ Broadcast Channelï¼Œè¿˜æ˜¯ Service Worker ï¼Œæˆ–æ˜¯ storage äº‹ä»¶ï¼Œå…¶éƒ½æ˜¯â€œå¹¿æ’­æ¨¡å¼â€ï¼šä¸€ä¸ªé¡µé¢å°†æ¶ˆæ¯é€šçŸ¥ç»™ä¸€ä¸ªâ€œä¸­å¤®ç«™â€ï¼Œå†ç”±â€œä¸­å¤®ç«™â€é€šçŸ¥ç»™å„ä¸ªé¡µé¢ã€‚

è€Œå¯¹äº open & opener è¿™ç§æ–¹å¼ï¼Œç±»ä¼¼å‡»é¼“ä¼ èŠ±ï¼Œä¸€ä¸ªä¼ ä¸€ä¸ªï¼Œä¼ é€’çš„æ¶ˆæ¯ä»å‰å¾€åï¼Œä¸€æ¡é”é“¾ã€‚ä½†æ˜¯å¦‚æœé¡µé¢ä¸æ˜¯é€šè¿‡ä¸€ä¸ªé¡µé¢æ‰“å¼€çš„ï¼Œè€Œä¸”ç›´æ¥æ‰“å¼€çš„ï¼Œæˆ–è€…ä»ä¸‰æ–¹ç½‘ç«™è·³è½¬çš„ï¼Œé‚£è¿™æ¡é”é“¾å°†æ–­å¼€ã€‚

Shared Worker çš„æœ€å¤§é—®é¢˜åœ¨äºå®ç°è·¨é¡µé¢é€šä¿¡æ—¶çš„ï¼Œå®ƒæ— æ³•ä¸»åŠ¨é€šçŸ¥æ‰€æœ‰é¡µé¢ï¼Œéœ€è¦åˆ·æ–°é¡µé¢æˆ–è€…æ˜¯å®šæ—¶ä»»åŠ¡æ¥æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯éœ€è¦é…åˆè½®è¯¢æ¥ä½¿ç”¨ã€‚

æœ€ç»ˆåœ¨æˆ‘ä»¬å›¢é˜Ÿå¯¹äºå‰ç«¯è·¨é¡µé¢é€šä¿¡æœ€åé€‰æ‹©çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ onstorageï¼Œä¸»è¦è€ƒé‡çš„ä¸‰ä¸ªæ–¹é¢ï¼š

- å…¼å®¹æ€§ã€‚æµè§ˆå™¨æ”¯æŒåº¦ã€‚
- é€šç”¨æ€§ã€‚èƒ½å¦è¦†ç›–éœ€æ±‚ã€æ˜¯å¦å…·æœ‰æ‹“å±•æ€§ã€‚
- ä¾¿æ·æ€§ã€‚å¼€å‘ä¾¿æ·ç¨‹åº¦ã€‚

å…¶ä»–æ–¹æ¡ˆåœ¨è¿™ä¸‰ä¸ªæ–¹é¢æ¥è¯´éƒ½æˆ–å¤šæˆ–å°‘å­˜åœ¨ä¸€äº›ç¾ä¸­ä¸è¶³ã€‚
